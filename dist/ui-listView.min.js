!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){e.$root.$$phase||e.$digest()}var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=angular.module("ui-listView",["ui-listView.templates"]),l=/^\s*([a-zA-Z0-9]+)\s+(?:in)\s+([a-zA-Z0-9.]+(\s*[|].*$)?)/,s={preferredHeight:48},r=function(){function t(){e(this,t),this.cells=[],this.search=null,this.setOptions({})}return i(t,[{key:"setOptions",value:function(e){this._addDefaultOptions(e),e.listView=this,this.options=e,this.reload([])}},{key:"reload",value:function(e){e&&e!==this.originalItems||!this.originalItems?(this._clear(),this.originalItems=e):e=this.originalItems,this.rows.length>e.length&&(this.rows.length=e.length),this._rebuildRows(e)}},{key:"requestOffsetUpdate",value:function(e){var t=this,i=this._request;i||(this._request=i={startIndex:e},this._callDelegate("throttle",function(){t.updateRowOffsets(i.startIndex),t._request=null})),i.startIndex=Math.min(i.startIndex,e)}},{key:"updateRowOffsets",value:function(e){e=e||0;var t,i,n=this.rows,l=n[e].offset;for(i=e;i<n.length;i++)t=n[i],t.offset=l,t.cell&&this._callCellDelegate(t.cell,"offsetDidChange",t.offset),l+=t.height;this.layout()}},{key:"updateCells",value:function(){var e,t,i,n=this.visibleRange,l=n.index,s=l+n.length,r=this.rows,o=this.cells;l>1&&l%2&&l--,o.length=n.length;for(var a=l;a<s;a++)e=o[a-l],t=r[a],e||(e=o[a-l]={}),e.row&&(e.row.cell=null),t.cell=e,e.row=t,e.item=r[a].item,e.index=a,e.itemIdentifier=this._callDelegate("getItemIdentifier",e.item),i&&(t.offset=i.offset+i.height),this._callCellDelegate(e,"rowDidChange",t),i=t}},{key:"updateAnchor",value:function(){var e=this.getScrollHeight(),t=this._lastScrollHeight;return this.anchor&&(this.anchor.updateAnchor(e),this._lastScrollHeight=e),e!==t}},{key:"updateRange",value:function(){for(var e,t,i,n=this.viewport,l=n.offset,s=l+n.height,r=this.rows,o=this._findVisibleRowIndex(l,s),a=0,u=0,h=0,c=this.visibleRange;!t||!i;)t||(e=r[o-h],(!e||e.offset+e.height<l)&&(t=!0,a=Math.max(o-h,0))),i||(e=r[o+h],(!e||e.offset>s)&&(i=!0,u=Math.min(o+h,r.length))),h++;return this.options.range=this.visibleRange={index:a,length:u-a,total:r.length},c.index!==this.visibleRange.index||c.length!==this.visibleRange.length}},{key:"setViewport",value:function(e,t){return this.viewport={offset:e,height:t},this.layout()}},{key:"layout",value:function(){return this.updateAnchor(),!!this.updateRange()&&(this.updateCells(),!0)}},{key:"getScrollHeight",value:function(){var e=this.rows.length,t=this.rows[e-1];return e?t.offset+t.height:0}},{key:"getCellStyle",value:function(e){return{top:e.row.offset+"px"}}},{key:"_addDefaultOptions",value:function(e){for(var t in s)!e.hasOwnProperty(t)&&s.hasOwnProperty(t)&&(e[t]=s[t])}},{key:"_clear",value:function(e){this.originalItems=[],this.rows&&!e||(this.rows=[]),this.cells=[],this.options.range=this.visibleRange={index:0,length:0}}},{key:"_rebuildRows",value:function(e){for(var t,i=0,n=this.rows,l=0;l<e.length;l++)t=n[l],t||(t=n[l]={height:this.options.preferredHeight,offset:i}),t.index=l,t.item=e[l],t.cell=null,i+=t.height}},{key:"_findVisibleRowIndex",value:function(e,t){var i,n=this.visibleRange,l=this.rows,s=Math.floor(n.index+n.length/2),r=0,o=l.length;for(s>l.length-1&&(s=Math.max(l.length-1,0));o>=r&&l[s];){if(i=l[s],i.offset+i.height<e)r=s+1;else{if(!(i.offset>t))break;o=s-1}s=r+Math.round((o-r)/2)}return s}},{key:"_callDelegate",value:function(e,t,i,n){var l=this.delegate;if(l)return l[e](t,i,n)}},{key:"_callCellDelegate",value:function(e,t,i,n,l){var s=e.delegate;if(s)return s[t](i,n,l)}}]),t}();n.controller("UIListView",r),n.directive("uiListView",["$rootScope","$parse",function(e,i){return{templateUrl:"ui-listView.tpl.html",replace:!0,transclude:!0,scope:{options:"=",search:"="},controller:"UIListView",controllerAs:"listView",require:"uiListView",compile:function(e,n){var s=l.exec(n.uiListView);if(!s)throw Error('Invalid expression.  It must be in the form "item in Array" ');var r=s[1],o=i(s[2]);return function(e,i,n,l){function s(){return l.setViewport(h.scrollTop,h.clientHeight)}function a(){s()&&(c=!0,t(e),c=!1),clearTimeout(f),f=setTimeout(function(){s(),t(e)})}function u(){t(e)}var h=i[0];l.delegate={getItemIdentifier:function(){return r},throttle:function(i){e.$$postDigest(i),t(e)}},e.$watch("options",function(e){l.setOptions(e||{})});var c,f;e.$watchCollection(function(){return c?l.originalItems:o(e.$parent)},function(e){l.reload(e),s()}),e.$watch(function(){return h.clientHeight+"-"+h.clientWidth},function(){s()}),h.addEventListener("scroll",a,!1),window.addEventListener("resize",u),e.$on("$destroy",function(){window.removeEventListener("resize",u)})}}}}]),angular.module("ui-listView.templates",[]).run(["$templateCache",function(e){e.put("ui-listView.tpl.html",'<div class="ui-list-view">\n  <div class="ui-list-view-search">\n    <span class="ui-list-view-search-label">{{listView.placeholder}}</span>\n    <div class="ui-list-view-search-container">\n      <input type="text" placeholder="{{listView.placeholder}}" ng-model="listView.search">\n    </div>\n  </div>\n  <div class="ui-list-view-cell" ui-list-view-cell ng-repeat="cell in listView.cells">\n    <div class="ui-list-view-cell-content"></div>\n  </div>\n  <div class="ui-list-view-anchor" ui-list-view-anchor></div>\n</div>\n')}]),angular.module("ui-listView").directive("uiListViewAnchor",function(){return{require:"^uiListView",link:function(e,t,i,n){var l=t[0];n.anchor={updateAnchor:function(e){l.style.top=e+"px"}}}}}),angular.module("ui-listView").directive("uiListViewCell",function(){return{require:"^uiListView",link:function(e,t,i,n,l){function s(e){u.style.top=e+"px"}function r(){var e=u.clientHeight,t=h.row;e!==t.height&&(t.height=e,n.requestOffsetUpdate(t.index))}function o(e){a[h.itemIdentifier]=e.item,a.$index=e.index,a.$first=0===e.index,a.$last=e.index===n.rows.length-1,s(e.offset)}var a,u=t[0],h=e.cell;l(function(e,i){var n=t.children();a=i,o(h.row),n.empty(),n.append(e)}),e.$watch(function(){return h.row.index+"-"+u.clientHeight},function(){r()}),h.delegate={rowDidChange:o,offsetDidChange:s},o(h.row)}}})}();